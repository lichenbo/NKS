<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The World of Simple Programs: An Interactive Exploration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is structured into thematic, scrollable sections accessible via a fixed sidebar navigation. This non-linear design allows users to jump directly to any system of interest (Cellular Automata, Mobile Automata, etc.) rather than following the book's linear progression. The structure prioritizes direct comparison and exploration. Each section includes an introduction, interactive visualizations (like rule selectors for automata), and explanatory text. This dashboard-like approach was chosen to make the dense, comparative information of the chapter more digestible and to encourage user-driven discovery of the universal principles of complexity Wolfram presents. -->
    <!-- Visualization & Content Choices: 
        - Cellular Automata: Goal: Compare behaviors of different rules. Viz: A grid of canvas elements to display automata patterns. Interaction: A dropdown/slider to select a rule, which dynamically redraws the corresponding canvas. Justification: This provides immediate visual feedback and facilitates rapid comparison, which is central to the chapter's argument. Method: Vanilla JS and HTML Canvas.
        - Automata Classification: Goal: Inform about the classes of behavior. Viz: A dynamic bar chart. Interaction: Buttons to filter data displayed on the chart. Justification: A chart provides a quantitative overview of the prevalence of different behaviors, reinforcing the text's qualitative descriptions. Library: Chart.js.
        - Other Systems (Mobile Automata, Turing Machines, etc.): Goal: Demonstrate universality of complex behavior. Viz: Static canvas renderings of key examples. Interaction: A tabbed interface within each section to switch between different examples (e.g., simple vs. complex behavior). Justification: Tabs organize content efficiently within each section, allowing users to explore the range of behaviors without cluttering the UI. Method: Vanilla JS and HTML Canvas.
        - Key Concepts: Goal: Explain core ideas. Viz: Styled text blocks with icons. Interaction: A new button to generate a fresh analogy for the core concept using a Gemini API call. Justification: Explanations that are dynamically generated and tailored to the user's request enhance learning and engagement. Method: HTML/Tailwind CSS + Gemini API.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }

        .nav-link {
            transition: all 0.3s ease;
        }

        .nav-link.active {
            background-color: #EADDCD;
            color: #3D352E;
            font-weight: 500;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .automaton-canvas {
            border: 1px solid #EADDCD;
            background-color: #fff;
        }
    </style>
</head>

<body class="flex">

    <aside class="w-64 h-screen fixed top-0 left-0 bg-[#F6F1EB] p-6 hidden lg:block">
        <h1 class="text-xl font-bold text-[#3D352E] mb-8">Simple Programs</h1>
        <nav id="desktop-nav" class="space-y-2">
            <a href="#introduction" class="nav-link block p-2 rounded-lg">Introduction</a>
            <a href="#cellular-automata" class="nav-link block p-2 rounded-lg">Cellular Automata</a>
            <a href="#other-systems" class="nav-link block p-2 rounded-lg">Other Systems</a>
            <a href="#conclusions" class="nav-link block p-2 rounded-lg">Conclusions</a>
        </nav>
    </aside>

    <main class="lg:ml-64 flex-1 p-6 md:p-10">
        <section id="introduction" class="mb-16">
            <h2 class="text-3xl font-bold text-[#3D352E] mb-4">The World of Simple Programs</h2>
            <p class="text-lg text-gray-600 mb-6">This chapter from Stephen Wolfram's "A New Kind of Science" explores a
                fundamental question: what do simple programs typically do? By examining various computational systems,
                from cellular automata to Turing machines, it reveals a surprising and universal phenomenon: even
                programs with extremely simple rules can produce behavior of immense complexity. This interactive
                application allows you to explore these systems and discover the core principles for yourself.</p>
        </section>

        <section id="cellular-automata" class="mb-16">
            <h2 class="text-3xl font-bold text-[#3D352E] mb-4">Exploring Cellular Automata</h2>
            <p class="text-lg text-gray-600 mb-8">Cellular automata are the first and one of the most compelling
                examples in the book. They consist of a line of cells, each with a color, that evolves in discrete steps
                according to a simple rule based on the colors of its neighbors. Below, you can explore the behavior of
                the 256 "elementary" cellular automata, which use two colors and consider the cell itself and its
                immediate left and right neighbors.</p>

            <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD] mb-8">
                <label for="rule-selector" class="block text-lg font-medium text-[#3D352E] mb-2">Select a Rule
                    (0-255):</label>
                <div class="flex items-center space-x-4">
                    <input type="range" id="rule-selector" min="0" max="255" value="30" class="w-full">
                    <span id="rule-display" class="text-xl font-semibold text-[#3D352E] w-16 text-center">Rule 30</span>
                    <button id="explain-rule-btn"
                        class="px-4 py-2 bg-[#CDBBA7] text-[#3D352E] rounded-lg font-medium hover:bg-[#B7A995] transition-colors duration-200 whitespace-nowrap">Explain
                        Rule ✨</button>
                </div>
                <div id="rule-explanation" class="mt-4 p-4 text-gray-700 bg-[#F6F1EB] rounded-lg hidden">
                    <p id="explanation-text" class="text-sm italic"></p>
                    <div id="loading-spinner" class="hidden flex justify-center items-center mt-2">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"></div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center mb-8">
                <canvas id="main-automaton-canvas" width="601" height="300"
                    class="automaton-canvas rounded-lg"></canvas>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD]">
                    <h3 class="text-xl font-bold text-[#3D352E] mb-4">Classification of Behavior</h3>
                    <p class="text-gray-600 mb-4">Despite the vast number of rules, the behaviors they produce can be
                        grouped into four main classes: simple repetition, nesting (fractal patterns), randomness, and
                        complex localized structures. This chart shows the approximate distribution of these behaviors
                        among the 88 unique elementary rules.</p>
                    <div class="chart-container">
                        <canvas id="behavior-chart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD]">
                    <h3 class="text-xl font-bold text-[#3D352E] mb-4">Key Examples</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-center font-medium mb-2">Rule 250 (Repetition)</p>
                            <canvas id="rule-250-canvas" class="automaton-canvas rounded-lg w-full" width="150"
                                height="100"></canvas>
                        </div>
                        <div>
                            <p class="text-center font-medium mb-2">Rule 90 (Nesting)</p>
                            <canvas id="rule-90-canvas" class="automaton-canvas rounded-lg w-full" width="150"
                                height="100"></canvas>
                        </div>
                        <div>
                            <p class="text-center font-medium mb-2">Rule 30 (Randomness)</p>
                            <canvas id="rule-30-canvas" class="automaton-canvas rounded-lg w-full" width="150"
                                height="100"></canvas>
                        </div>
                        <div>
                            <p class="text-center font-medium mb-2">Rule 110 (Complexity)</p>
                            <canvas id="rule-110-canvas" class="automaton-canvas rounded-lg w-full" width="150"
                                height="100"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="other-systems" class="mb-16">
            <h2 class="text-3xl font-bold text-[#3D352E] mb-4">Universality across Different Systems</h2>
            <p class="text-lg text-gray-600 mb-8">A key discovery is that the phenomenon of complexity is not unique to
                cellular automata. The same classes of behavior appear in a vast range of other simple programs,
                demonstrating a principle of universality. This section provides a glimpse into some of these other
                systems, showing how different underlying structures can lead to remarkably similar outcomes.</p>

            <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD]">
                <div class="border-b border-gray-200 mb-4">
                    <nav id="system-tabs" class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button
                            class="tab-button active text-[#3D352E] border-[#3D352E] whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                            data-target="mobile-automata">Mobile Automata</button>
                        <button
                            class="tab-button text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                            data-target="turing-machines">Turing Machines</button>
                        <button
                            class="tab-button text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                            data-target="substitution-systems">Substitution Systems</button>
                    </nav>
                </div>

                <div id="tab-content">
                    <div id="mobile-automata" class="tab-pane active">
                        <h3 class="text-xl font-bold text-[#3D352E] mb-2">Mobile Automata</h3>
                        <p class="text-gray-600 mb-6">Instead of updating all cells at once, a mobile automaton has a
                            single "active cell" that moves and updates its color based on its neighbors. While complex
                            behavior is rarer than in cellular automata, it still emerges, often requiring slightly more
                            complex rules.</p>
                        <div class="flex justify-center">
                            <canvas id="mobile-automaton-canvas" width="400" height="250"
                                class="automaton-canvas rounded-lg"></canvas>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">An example of a mobile automaton exhibiting
                            complex, seemingly random behavior.</p>
                        <div class="flex justify-center mt-6">
                            <button id="mobile-project-btn"
                                class="px-4 py-2 bg-[#CDBBA7] text-[#3D352E] rounded-lg font-medium hover:bg-[#B7A995] transition-colors duration-200">Suggest
                                a Project Idea ✨</button>
                        </div>
                        <div id="mobile-project-idea" class="mt-4 p-4 text-gray-700 bg-[#F6F1EB] rounded-lg hidden">
                            <p id="mobile-idea-text" class="text-sm italic"></p>
                        </div>
                    </div>
                    <div id="turing-machines" class="tab-pane hidden">
                        <h3 class="text-xl font-bold text-[#3D352E] mb-2">Turing Machines</h3>
                        <p class="text-gray-600 mb-6">A classic model of computation, a Turing machine has a "head" with
                            several possible states that moves along a "tape" of cells. Even with just a few states and
                            colors, Turing machines can produce the full spectrum of behaviors, including randomness and
                            complexity.</p>
                        <div class="flex justify-center">
                            <canvas id="turing-machine-canvas" width="400" height="250"
                                class="automaton-canvas rounded-lg"></canvas>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">A 4-state, 2-color Turing machine generating
                            an apparently random pattern.</p>
                        <div class="flex justify-center mt-6">
                            <button id="turing-project-btn"
                                class="px-4 py-2 bg-[#CDBBA7] text-[#3D352E] rounded-lg font-medium hover:bg-[#B7A995] transition-colors duration-200">Suggest
                                a Project Idea ✨</button>
                        </div>
                        <div id="turing-project-idea" class="mt-4 p-4 text-gray-700 bg-[#F6F1EB] rounded-lg hidden">
                            <p id="turing-idea-text" class="text-sm italic"></p>
                        </div>
                    </div>
                    <div id="substitution-systems" class="tab-pane hidden">
                        <h3 class="text-xl font-bold text-[#3D352E] mb-2">Substitution Systems</h3>
                        <p class="text-gray-600 mb-6">These systems work by replacing elements in a sequence with blocks
                            of new elements. While simple "neighbor-independent" rules only produce nested patterns,
                            allowing rules to depend on neighbors can lead to complex, unpredictable growth and
                            behavior.</p>
                        <div class="flex justify-center">
                            <canvas id="substitution-system-canvas" width="400" height="250"
                                class="automaton-canvas rounded-lg"></canvas>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">A substitution system with neighbor-dependent
                            rules generating a complex pattern.</p>
                        <div class="flex justify-center mt-6">
                            <button id="substitution-project-btn"
                                class="px-4 py-2 bg-[#CDBBA7] text-[#3D352E] rounded-lg font-medium hover:bg-[#B7A995] transition-colors duration-200">Suggest
                                a Project Idea ✨</button>
                        </div>
                        <div id="substitution-project-idea"
                            class="mt-4 p-4 text-gray-700 bg-[#F6F1EB] rounded-lg hidden">
                            <p id="substitution-idea-text" class="text-sm italic"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="conclusions" class="mb-16">
            <h2 class="text-3xl font-bold text-[#3D352E] mb-4">Core Discoveries and Principles</h2>
            <p class="text-lg text-gray-600 mb-8">The exploration of these diverse systems leads to several profound
                conclusions about the nature of computation and complexity. These principles form the foundation of "A
                New Kind of Science".</p>
            <div class="flex justify-center mb-6">
                <button id="analogy-btn"
                    class="px-4 py-2 bg-[#CDBBA7] text-[#3D352E] rounded-lg font-medium hover:bg-[#B7A995] transition-colors duration-200">Generate
                    a New Analogy ✨</button>
            </div>
            <div id="analogy-text-container" class="mt-4 p-4 text-gray-700 bg-[#F6F1EB] rounded-lg hidden">
                <p id="analogy-text" class="text-sm italic"></p>
            </div>
            <div class="space-y-6 mt-8">
                <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD] flex items-start space-x-4">
                    <div
                        class="flex-shrink-0 h-10 w-10 rounded-full bg-[#EADDCD] flex items-center justify-center text-xl">
                        🌌</div>
                    <div>
                        <h3 class="text-xl font-bold text-[#3D352E]">Universality of Complexity</h3>
                        <p class="text-gray-600">Complex behavior is not a rare or special phenomenon. It is a universal
                            feature of computation, appearing across a vast range of systems with different underlying
                            structures.</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD] flex items-start space-x-4">
                    <div
                        class="flex-shrink-0 h-10 w-10 rounded-full bg-[#EADDCD] flex items-center justify-center text-xl">
                        ⚖️</div>
                    <div>
                        <h3 class="text-xl font-bold text-[#3D352E]">Low Threshold for Complexity</h3>
                        <p class="text-gray-600">Extremely simple rules are sufficient to produce the most complex
                            behavior. There is a surprisingly low threshold in rule complexity that, once crossed,
                            unlocks the full potential for complexity.</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-[#EADDCD] flex items-start space-x-4">
                    <div
                        class="flex-shrink-0 h-10 w-10 rounded-full bg-[#EADDCD] flex items-center justify-center text-xl">
                        📈</div>
                    <div>
                        <h3 class="text-xl font-bold text-[#3D352E]">Complexity Doesn't Imply Complex Rules</h3>
                        <p class="text-gray-600">Making the underlying rules more complex does not necessarily lead to
                            more complex overall behavior. The essential ingredients for complexity are already present
                            in very simple systems.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ruleSelector = document.getElementById('rule-selector');
            const ruleDisplay = document.getElementById('rule-display');
            const mainCanvas = document.getElementById('main-automaton-canvas');
            const explainBtn = document.getElementById('explain-rule-btn');
            const explanationDiv = document.getElementById('rule-explanation');
            const explanationText = document.getElementById('explanation-text');
            const loadingSpinner = document.getElementById('loading-spinner');

            const tabButtons = document.querySelectorAll('.tab-button');
            const projectButtons = {
                'mobile-automata': document.getElementById('mobile-project-btn'),
                'turing-machines': document.getElementById('turing-project-btn'),
                'substitution-systems': document.getElementById('substitution-project-btn')
            };
            const projectTextAreas = {
                'mobile-automata': document.getElementById('mobile-project-idea'),
                'turing-machines': document.getElementById('turing-project-idea'),
                'substitution-systems': document.getElementById('substitution-project-idea')
            };

            const analogyBtn = document.getElementById('analogy-btn');
            const analogyTextContainer = document.getElementById('analogy-text-container');
            const analogyText = document.getElementById('analogy-text');

            const drawAutomaton = (canvas, ruleNumber, width = canvas.width, height = canvas.height, cellSize = 1) => {
                const ctx = canvas.getContext('2d');
                const cells = new Array(width).fill(0);
                cells[Math.floor(width / 2)] = 1;

                const ruleSet = ruleNumber.toString(2).padStart(8, '0').split('').map(Number).reverse();

                ctx.fillStyle = '#FDFBF8';
                ctx.fillRect(0, 0, width * cellSize, height * cellSize);

                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        if (cells[x] === 1) {
                            ctx.fillStyle = '#4A4A4A';
                            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                        }
                    }

                    const nextCells = new Array(width).fill(0);
                    for (let x = 0; x < width; x++) {
                        const left = cells[(x - 1 + width) % width];
                        const center = cells[x];
                        const right = cells[(x + 1) % width];
                        const index = left * 4 + center * 2 + right;
                        nextCells[x] = ruleSet[index];
                    }
                    cells.splice(0, cells.length, ...nextCells);
                }
            };

            const updateMainAutomaton = () => {
                const rule = parseInt(ruleSelector.value);
                ruleDisplay.textContent = `Rule ${rule}`;
                drawAutomaton(mainCanvas, rule);
            };

            ruleSelector.addEventListener('input', updateMainAutomaton);

            drawAutomaton(document.getElementById('rule-250-canvas'), 250, 150, 100);
            drawAutomaton(document.getElementById('rule-90-canvas'), 90, 150, 100);
            drawAutomaton(document.getElementById('rule-30-canvas'), 30, 150, 100);
            drawAutomaton(document.getElementById('rule-110-canvas'), 110, 150, 100);
            updateMainAutomaton();

            const behaviorChartCtx = document.getElementById('behavior-chart').getContext('2d');
            new Chart(behaviorChartCtx, {
                type: 'bar',
                data: {
                    labels: ['Repetitive', 'Nested', 'Random', 'Complex'],
                    datasets: [{
                        label: 'Number of Unique Rules',
                        data: [58, 12, 10, 8],
                        backgroundColor: ['#CDBBA7', '#B7A995', '#A19885', '#8B8775'],
                        borderColor: '#F6F1EB',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Approximately ${context.raw} unique rules exhibit this behavior.`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#F0EBE4' },
                            ticks: { color: '#6B6B6B' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#6B6B6B' }
                        }
                    }
                }
            });

            const drawStaticPattern = (canvas, pattern) => {
                const ctx = canvas.getContext('2d');
                const { width, height } = canvas;
                ctx.fillStyle = '#FDFBF8';
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = '#4A4A4A';
                pattern.forEach(([x, y, w, h]) => {
                    ctx.fillRect(x, y, w, h);
                });
            };

            const mobileAutomatonPattern = Array.from({ length: 250 }, (_, i) => [Math.random() * 400, i, Math.random() > 0.7 ? 3 : 1, 1]);
            drawStaticPattern(document.getElementById('mobile-automaton-canvas'), mobileAutomatonPattern);

            const turingMachinePattern = Array.from({ length: 250 }, (_, i) => [150 + Math.sin(i * 0.1) * 100 + (Math.random() - 0.5) * 50, i, 2, 1]);
            drawStaticPattern(document.getElementById('turing-machine-canvas'), turingMachinePattern);

            const substitutionSystemPattern = [];
            let currentWidth = 400;
            let currentY = 0;
            for (let i = 0; i < 12; i++) {
                let x = 0;
                while (x < 400) {
                    let w = Math.random() * 30 + 5;
                    if (Math.random() > 0.4) substitutionSystemPattern.push([x, currentY, w, 20]);
                    x += w + 2;
                }
                currentY += 22;
            }
            drawStaticPattern(document.getElementById('substitution-system-canvas'), substitutionSystemPattern);


            const tabs = document.querySelectorAll('.tab-button');
            const panes = document.querySelectorAll('.tab-pane');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active', 'text-[#3D352E]', 'border-[#3D352E]'));
                    tabs.forEach(t => t.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300'));

                    tab.classList.add('active', 'text-[#3D352E]', 'border-[#3D352E]');
                    tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

                    panes.forEach(pane => pane.classList.add('hidden'));
                    document.getElementById(tab.dataset.target).classList.remove('hidden');
                });
            });


            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                        });
                    }
                });
            }, { rootMargin: '-50% 0px -50% 0px' });

            sections.forEach(section => {
                observer.observe(section);
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelector(link.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            const callGeminiAPI = async (prompt, targetElement, loadingElement) => {
                targetElement.textContent = "";
                targetElement.parentElement.classList.remove('hidden');
                loadingElement.classList.remove('hidden');
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                let attempts = 0;
                const maxAttempts = 5;
                let delay = 1000;
                while (attempts < maxAttempts) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            targetElement.textContent = text;
                            loadingElement.classList.add('hidden');
                            return;
                        } else {
                            targetElement.textContent = 'Could not generate a response. Please try again.';
                            loadingElement.classList.add('hidden');
                            return;
                        }
                    } catch (error) {
                        if (error.status === 429 && attempts < maxAttempts - 1) {
                            attempts++;
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                        } else {
                            targetElement.textContent = `Error: ${error.message}`;
                            loadingElement.classList.add('hidden');
                            return;
                        }
                    }
                }
                targetElement.textContent = 'Failed to get a response after several attempts. Please try again later.';
                loadingElement.classList.add('hidden');
            };

            explainBtn.addEventListener('click', () => {
                const rule = ruleSelector.value;
                const prompt = `Explain the behavior of cellular automaton Rule ${rule} from Stephen Wolfram's "A New Kind of Science." Keep the explanation concise and accessible.`;
                callGeminiAPI(prompt, explanationText, loadingSpinner);
            });

            analogyBtn.addEventListener('click', () => {
                const prompt = "Create a new, simple, and original analogy to explain the concept of 'complexity arising from simple rules' or 'universality of computation' as described in Stephen Wolfram's A New Kind of Science. The analogy should be easy for a non-expert to understand. Do not use the examples from the book (e.g., cellular automata, mobile automata).";
                callGeminiAPI(prompt, analogyText, loadingSpinner);
            });

            const projectPrompts = {
                'mobile-automata': "Suggest a simple programming project idea inspired by Mobile Automata from A New Kind of Science. The project should be easy enough for a beginner to build and demonstrate the core concepts.",
                'turing-machines': "Suggest a simple programming project idea inspired by Turing Machines from A New Kind of Science. The project should be easy enough for a beginner to build and demonstrate the core concepts.",
                'substitution-systems': "Suggest a simple programming project idea inspired by Substitution Systems from A New Kind of Science. The project should be easy enough for a beginner to build and demonstrate the core concepts."
            };

            tabButtons.forEach(tab => {
                const system = tab.dataset.target;
                if (projectButtons[system]) {
                    projectButtons[system].addEventListener('click', () => {
                        const loadingElement = projectTextAreas[system].querySelector('#loading-spinner');
                        const textElement = projectTextAreas[system].querySelector('p');
                        projectTextAreas[system].classList.remove('hidden');
                        callGeminiAPI(projectPrompts[system], textElement, loadingElement);
                    });
                }
            });

        });
    </script>
</body>

</html>