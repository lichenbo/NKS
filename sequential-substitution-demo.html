<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequential Substitution Systems Demo - NKS Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .header h1 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .header p {
            color: #b8b8b8;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .control-panel h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #d0d0d0;
            margin-bottom: 5px;
            font-weight: 500;
        }

        select, input[type="range"], input[type="text"], button, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            height: 80px;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px 0;
        }

        button:hover {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.4));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }

        .visualization-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
            margin-bottom: 20px;
        }

        .execution-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .step-entry {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.02);
            transition: background 0.3s ease;
        }

        .step-entry.current {
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #ffd700;
        }

        .step-number {
            color: #ffd700;
            font-weight: bold;
            min-width: 50px;
            margin-right: 15px;
        }

        .step-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .string-state {
            word-break: break-all;
            color: #e0e0e0;
        }

        .rule-applied {
            color: #4ecdc4;
            font-size: 12px;
        }

        .pattern-match {
            color: #ff6b6b;
            font-size: 12px;
        }

        .no-match {
            color: #888;
            font-style: italic;
            font-size: 12px;
        }

        .symbol {
            display: inline-block;
            margin: 0 1px;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .symbol-A { background: #ff6b6b; color: white; }
        .symbol-B { background: #4ecdc4; color: white; }
        .symbol-C { background: #45b7d1; color: white; }
        .symbol-0 { background: #ffffff; color: black; }
        .symbol-1 { background: #96ceb4; color: white; }
        .symbol-2 { background: #ffd93d; color: black; }
        .symbol-X { background: #ff8c94; color: white; }
        .symbol-Y { background: #a8e6cf; color: black; }

        .highlighted-match {
            background: #ff6b6b !important;
            color: white !important;
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .rules-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .rules-display h4 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
        }

        .rule-priority-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .rule-item {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            text-align: center;
            position: relative;
        }

        .rule-item.active {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
        }

        .rule-priority {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #ffd700;
            color: black;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .rule-arrow {
            color: #ffd700;
            margin: 0 10px;
        }

        .causal-network {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow: auto;
        }

        .causal-network h4 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
        }

        .network-node {
            display: inline-block;
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .network-edge {
            display: inline-block;
            color: #4ecdc4;
            margin: 0 5px;
        }

        .comparison-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
        }

        .comparison-section h4 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
        }

        .custom-rules-editor {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .info-panel h3 {
            color: #ffd700;
            margin-bottom: 15px;
        }

        .info-panel p {
            color: #d0d0d0;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.9em;
            color: #b8b8b8;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .rule-priority-list {
                grid-template-columns: 1fr;
            }
            
            .comparison-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sequential Substitution Systems Demo</h1>
            <p>Explore Wolfram's sequential substitution systems from "A New Kind of Science" (Pages 88-89)<br>
               One-at-a-time string rewriting with causal network generation and multiway analysis</p>
        </div>

        <div class="controls">
            <div class="control-panel">
                <h3>System Selection</h3>
                <div class="control-group">
                    <label for="systemPreset">Predefined Systems:</label>
                    <select id="systemPreset">
                        <option value="nks88">NKS Page 88 (A→AB, BA→A)</option>
                        <option value="nks89">NKS Page 89 (AB→B, BA→A)</option>
                        <option value="simple">Simple (A→B, B→A)</option>
                        <option value="complex">Complex Growth (A→BC, B→A, C→AB)</option>
                        <option value="competing">Competing (AA→B, BB→A, AB→AA)</option>
                        <option value="cyclic">Cyclic (A→B, B→C, C→A)</option>
                        <option value="tag">Tag System (000→00101, 101→0)</option>
                        <option value="custom">Custom System</option>
                    </select>
                </div>
                
                <div class="custom-rules-editor" id="customRulesEditor">
                    <label for="customRules">Custom Rules (priority order, format: AB→C):</label>
                    <textarea id="customRules" placeholder="A→AB&#10;BA→A&#10;B→BB"></textarea>
                    <button id="applyCustom">Apply Custom Rules</button>
                </div>
            </div>

            <div class="control-panel">
                <h3>Execution Control</h3>
                <div class="control-group">
                    <label for="speed">Animation Speed:</label>
                    <input type="range" id="speed" min="200" max="3000" value="1000">
                    <span id="speedValue">1000ms</span>
                </div>
                <div class="control-group">
                    <label for="maxSteps">Max Steps:</label>
                    <input type="range" id="maxSteps" min="10" max="100" value="30">
                    <span id="maxStepsValue">30</span>
                </div>
                <div class="control-group">
                    <label for="scanMode">Scanning Mode:</label>
                    <select id="scanMode">
                        <option value="leftright">Left to Right</option>
                        <option value="rightleft">Right to Left</option>
                        <option value="random">Random Position</option>
                    </select>
                </div>
                <button id="startBtn">Start Evolution</button>
                <button id="stopBtn">Stop Evolution</button>
                <button id="stepBtn">Single Step</button>
                <button id="resetBtn">Reset System</button>
            </div>

            <div class="control-panel">
                <h3>Initial Configuration</h3>
                <div class="control-group">
                    <label for="initialString">Starting String:</label>
                    <input type="text" id="initialString" value="AABBA" placeholder="e.g., AAB, 000101">
                </div>
                <div class="control-group">
                    <label for="viewMode">Analysis Mode:</label>
                    <select id="viewMode">
                        <option value="sequential">Sequential Evolution</option>
                        <option value="comparison">Sequential vs Parallel</option>
                        <option value="causal">Causal Network</option>
                        <option value="multiway">Multiway System</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="visualization-container">
            <h3 style="color: #ffd700; margin-bottom: 15px;">Sequential Substitution Evolution</h3>
            
            <div class="rules-display" id="rulesDisplay">
                <h4>Rules (Applied in Priority Order)</h4>
                <div class="rule-priority-list" id="rulePriorityList"></div>
            </div>

            <div class="execution-display" id="executionDisplay"></div>
            
            <div class="comparison-panel" id="comparisonPanel" style="display: none;">
                <div class="comparison-section">
                    <h4>Sequential Evolution</h4>
                    <div id="sequentialResults"></div>
                </div>
                <div class="comparison-section">
                    <h4>Parallel Evolution</h4>
                    <div id="parallelResults"></div>
                </div>
            </div>

            <div class="causal-network" id="causalNetwork" style="display: none;">
                <h4>Causal Network</h4>
                <div id="networkDisplay"></div>
            </div>
        </div>

        <div class="info-panel">
            <h3>About Sequential Substitution Systems</h3>
            <p>
                Sequential substitution systems, explored by Stephen Wolfram in "A New Kind of Science" (pages 88-89), 
                differ from parallel systems by applying <strong>only one rule at a time</strong>. The system scans 
                the string from left to right, applies the first matching rule found, and then repeats. This creates 
                fundamentally different dynamics than parallel systems.
            </p>
            <p>
                These systems generate <strong>causal networks</strong> where each substitution event becomes a node, 
                connected to events that causally influence each other. This forms the foundation for Wolfram's work on 
                <strong>multiway systems</strong> and his theory of fundamental physics, where the universe might operate 
                as a giant sequential substitution system.
            </p>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="currentStep">0</div>
                    <div class="stat-label">Current Step</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stringLength">5</div>
                    <div class="stat-label">String Length</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="rulesApplied">0</div>
                    <div class="stat-label">Rules Applied</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="activeRule">None</div>
                    <div class="stat-label">Last Rule Used</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="causalEvents">0</div>
                    <div class="stat-label">Causal Events</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SequentialSubstitutionSystem {
            constructor() {
                this.rules = [];
                this.initialString = "AABBA";
                this.currentString = this.initialString;
                this.executionHistory = [];
                this.causalNetwork = [];
                this.currentStep = 0;
                this.isRunning = false;
                this.animationId = null;
                this.maxSteps = 30;
                this.scanMode = "leftright";
                this.viewMode = "sequential";
                
                this.initializeSystem();
            }

            initializeSystem() {
                // Default NKS Page 88 system
                this.rules = [
                    { pattern: "A", replacement: "AB", priority: 1 },
                    { pattern: "BA", replacement: "A", priority: 2 }
                ];
                
                this.reset();
                this.updateRulesDisplay();
            }

            setSystem(preset) {
                switch (preset) {
                    case 'nks88':
                        this.rules = [
                            { pattern: "A", replacement: "AB", priority: 1 },
                            { pattern: "BA", replacement: "A", priority: 2 }
                        ];
                        this.initialString = "AABBA";
                        break;
                    case 'nks89':
                        this.rules = [
                            { pattern: "AB", replacement: "B", priority: 1 },
                            { pattern: "BA", replacement: "A", priority: 2 }
                        ];
                        this.initialString = "ABBA";
                        break;
                    case 'simple':
                        this.rules = [
                            { pattern: "A", replacement: "B", priority: 1 },
                            { pattern: "B", replacement: "A", priority: 2 }
                        ];
                        this.initialString = "ABAB";
                        break;
                    case 'complex':
                        this.rules = [
                            { pattern: "A", replacement: "BC", priority: 1 },
                            { pattern: "B", replacement: "A", priority: 2 },
                            { pattern: "C", replacement: "AB", priority: 3 }
                        ];
                        this.initialString = "ABC";
                        break;
                    case 'competing':
                        this.rules = [
                            { pattern: "AA", replacement: "B", priority: 1 },
                            { pattern: "BB", replacement: "A", priority: 2 },
                            { pattern: "AB", replacement: "AA", priority: 3 }
                        ];
                        this.initialString = "AABB";
                        break;
                    case 'cyclic':
                        this.rules = [
                            { pattern: "A", replacement: "B", priority: 1 },
                            { pattern: "B", replacement: "C", priority: 2 },
                            { pattern: "C", replacement: "A", priority: 3 }
                        ];
                        this.initialString = "ABC";
                        break;
                    case 'tag':
                        this.rules = [
                            { pattern: "000", replacement: "00101", priority: 1 },
                            { pattern: "101", replacement: "0", priority: 2 }
                        ];
                        this.initialString = "000101";
                        break;
                }
                
                this.updateRulesDisplay();
                this.reset();
            }

            setCustomRules(rulesText) {
                const rules = [];
                const lines = rulesText.split('\n');
                
                let priority = 1;
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed && trimmed.includes('→')) {
                        const [left, right] = trimmed.split('→');
                        if (left && right) {
                            rules.push({
                                pattern: left.trim(),
                                replacement: right.trim(),
                                priority: priority++
                            });
                        }
                    }
                }
                
                if (rules.length > 0) {
                    this.rules = rules;
                    this.updateRulesDisplay();
                    this.reset();
                    return true;
                }
                return false;
            }

            reset() {
                this.stop();
                this.currentString = this.initialString;
                this.executionHistory = [{
                    step: 0,
                    string: this.currentString,
                    ruleApplied: null,
                    matchPosition: -1,
                    matchLength: 0
                }];
                this.causalNetwork = [];
                this.currentStep = 0;
                this.updateDisplay();
                this.updateStats();
            }

            findNextMatch() {
                // Sort rules by priority
                const sortedRules = [...this.rules].sort((a, b) => a.priority - b.priority);
                
                for (const rule of sortedRules) {
                    let position;
                    
                    switch (this.scanMode) {
                        case 'leftright':
                            position = this.currentString.indexOf(rule.pattern);
                            break;
                        case 'rightleft':
                            position = this.currentString.lastIndexOf(rule.pattern);
                            break;
                        case 'random':
                            const matches = [];
                            let pos = this.currentString.indexOf(rule.pattern);
                            while (pos !== -1) {
                                matches.push(pos);
                                pos = this.currentString.indexOf(rule.pattern, pos + 1);
                            }
                            position = matches.length > 0 ? matches[Math.floor(Math.random() * matches.length)] : -1;
                            break;
                    }
                    
                    if (position !== -1) {
                        return {
                            rule: rule,
                            position: position,
                            matchLength: rule.pattern.length
                        };
                    }
                }
                
                return null; // No matches found
            }

            step() {
                if (this.currentStep >= this.maxSteps) {
                    this.stop();
                    return false;
                }

                const match = this.findNextMatch();
                
                if (!match) {
                    // No more matches - system halts
                    this.executionHistory.push({
                        step: this.currentStep + 1,
                        string: this.currentString,
                        ruleApplied: null,
                        matchPosition: -1,
                        matchLength: 0,
                        halted: true
                    });
                    this.stop();
                    this.updateDisplay();
                    return false;
                }
                
                // Apply the substitution
                const newString = 
                    this.currentString.substring(0, match.position) +
                    match.rule.replacement +
                    this.currentString.substring(match.position + match.matchLength);
                
                this.currentStep++;
                this.currentString = newString;
                
                // Record execution step
                this.executionHistory.push({
                    step: this.currentStep,
                    string: this.currentString,
                    ruleApplied: match.rule,
                    matchPosition: match.position,
                    matchLength: match.matchLength
                });
                
                // Add to causal network
                this.causalNetwork.push({
                    event: this.currentStep,
                    rule: match.rule.pattern + '→' + match.rule.replacement,
                    position: match.position,
                    causedBy: this.currentStep - 1
                });
                
                this.updateDisplay();
                this.updateStats();
                
                return true;
            }

            updateRulesDisplay() {
                const rulePriorityList = document.getElementById('rulePriorityList');
                rulePriorityList.innerHTML = '';
                
                // Sort by priority for display
                const sortedRules = [...this.rules].sort((a, b) => a.priority - b.priority);
                
                sortedRules.forEach((rule, index) => {
                    const ruleItem = document.createElement('div');
                    ruleItem.className = 'rule-item';
                    ruleItem.id = `rule-${rule.priority}`;
                    
                    const priority = document.createElement('div');
                    priority.className = 'rule-priority';
                    priority.textContent = rule.priority;
                    
                    const content = document.createElement('div');
                    content.innerHTML = `
                        ${this.formatString(rule.pattern)}
                        <span class="rule-arrow">→</span>
                        ${this.formatString(rule.replacement)}
                    `;
                    
                    ruleItem.appendChild(priority);
                    ruleItem.appendChild(content);
                    rulePriorityList.appendChild(ruleItem);
                });
            }

            formatString(str) {
                return str.split('').map(char => 
                    `<span class="symbol symbol-${char}">${char}</span>`
                ).join('');
            }

            highlightPattern(str, position, length, highlight = false) {
                let result = '';
                for (let i = 0; i < str.length; i++) {
                    const char = str[i];
                    const className = highlight && i >= position && i < position + length ? 
                        `symbol symbol-${char} highlighted-match` : 
                        `symbol symbol-${char}`;
                    result += `<span class="${className}">${char}</span>`;
                }
                return result;
            }

            updateDisplay() {
                switch (this.viewMode) {
                    case 'sequential':
                        this.updateSequentialDisplay();
                        break;
                    case 'comparison':
                        this.updateComparisonDisplay();
                        break;
                    case 'causal':
                        this.updateCausalDisplay();
                        break;
                    case 'multiway':
                        this.updateMultiwayDisplay();
                        break;
                }
            }

            updateSequentialDisplay() {
                const executionDisplay = document.getElementById('executionDisplay');
                const comparisonPanel = document.getElementById('comparisonPanel');
                const causalNetwork = document.getElementById('causalNetwork');
                
                executionDisplay.style.display = 'block';
                comparisonPanel.style.display = 'none';
                causalNetwork.style.display = 'none';
                
                // Clear active rule highlighting
                document.querySelectorAll('.rule-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                executionDisplay.innerHTML = '';
                
                this.executionHistory.forEach((entry, index) => {
                    const stepEntry = document.createElement('div');
                    stepEntry.className = 'step-entry';
                    if (index === this.executionHistory.length - 1) {
                        stepEntry.classList.add('current');
                    }
                    
                    const stepNumber = document.createElement('div');
                    stepNumber.className = 'step-number';
                    stepNumber.textContent = `${entry.step}:`;
                    
                    const stepContent = document.createElement('div');
                    stepContent.className = 'step-content';
                    
                    const stringState = document.createElement('div');
                    stringState.className = 'string-state';
                    
                    if (entry.ruleApplied) {
                        // Highlight the matched pattern in the previous string
                        const prevEntry = this.executionHistory[index - 1];
                        if (prevEntry) {
                            stringState.innerHTML = this.highlightPattern(
                                prevEntry.string, 
                                entry.matchPosition, 
                                entry.matchLength, 
                                true
                            ) + ' → ' + this.formatString(entry.string);
                        } else {
                            stringState.innerHTML = this.formatString(entry.string);
                        }
                        
                        const ruleApplied = document.createElement('div');
                        ruleApplied.className = 'rule-applied';
                        ruleApplied.textContent = `Applied: ${entry.ruleApplied.pattern} → ${entry.ruleApplied.replacement} at position ${entry.matchPosition}`;
                        stepContent.appendChild(ruleApplied);
                        
                        // Highlight active rule
                        const ruleElement = document.getElementById(`rule-${entry.ruleApplied.priority}`);
                        if (ruleElement) {
                            ruleElement.classList.add('active');
                        }
                    } else if (entry.halted) {
                        stringState.innerHTML = this.formatString(entry.string);
                        const noMatch = document.createElement('div');
                        noMatch.className = 'no-match';
                        noMatch.textContent = 'System halted - no matching patterns found';
                        stepContent.appendChild(noMatch);
                    } else {
                        stringState.innerHTML = this.formatString(entry.string);
                    }
                    
                    stepContent.appendChild(stringState);
                    stepEntry.appendChild(stepNumber);
                    stepEntry.appendChild(stepContent);
                    executionDisplay.appendChild(stepEntry);
                });
                
                executionDisplay.scrollTop = executionDisplay.scrollHeight;
            }

            updateComparisonDisplay() {
                const executionDisplay = document.getElementById('executionDisplay');
                const comparisonPanel = document.getElementById('comparisonPanel');
                const causalNetwork = document.getElementById('causalNetwork');
                
                executionDisplay.style.display = 'none';
                comparisonPanel.style.display = 'grid';
                causalNetwork.style.display = 'none';
                
                // Update sequential results
                const sequentialResults = document.getElementById('sequentialResults');
                sequentialResults.innerHTML = '';
                
                this.executionHistory.forEach(entry => {
                    const div = document.createElement('div');
                    div.style.fontSize = '12px';
                    div.style.margin = '3px 0';
                    div.innerHTML = `${entry.step}: ${this.formatString(entry.string)}`;
                    sequentialResults.appendChild(div);
                });
                
                // Simulate parallel evolution for comparison
                const parallelResults = document.getElementById('parallelResults');
                parallelResults.innerHTML = '';
                
                const parallelEvolution = this.simulateParallelEvolution();
                parallelEvolution.forEach((entry, index) => {
                    const div = document.createElement('div');
                    div.style.fontSize = '12px';
                    div.style.margin = '3px 0';
                    div.innerHTML = `${index}: ${this.formatString(entry)}`;
                    parallelResults.appendChild(div);
                });
            }

            simulateParallelEvolution() {
                const results = [this.initialString];
                let current = this.initialString;
                
                for (let i = 0; i < Math.min(this.maxSteps, 15); i++) {
                    let newString = current;
                    let changed = false;
                    
                    // Apply all rules simultaneously
                    for (const rule of this.rules) {
                        const regex = new RegExp(rule.pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                        if (regex.test(newString)) {
                            newString = newString.replace(regex, rule.replacement);
                            changed = true;
                        }
                    }
                    
                    if (!changed) break;
                    
                    current = newString;
                    results.push(current);
                }
                
                return results;
            }

            updateCausalDisplay() {
                const executionDisplay = document.getElementById('executionDisplay');
                const comparisonPanel = document.getElementById('comparisonPanel');
                const causalNetwork = document.getElementById('causalNetwork');
                
                executionDisplay.style.display = 'none';
                comparisonPanel.style.display = 'none';
                causalNetwork.style.display = 'block';
                
                const networkDisplay = document.getElementById('networkDisplay');
                networkDisplay.innerHTML = '';
                
                if (this.causalNetwork.length === 0) {
                    networkDisplay.innerHTML = '<p style="text-align: center; color: #888;">No causal events yet. Run the system to generate the causal network.</p>';
                    return;
                }
                
                this.causalNetwork.forEach((event, index) => {
                    const eventDiv = document.createElement('div');
                    eventDiv.style.margin = '10px 0';
                    eventDiv.style.display = 'flex';
                    eventDiv.style.alignItems = 'center';
                    eventDiv.style.flexWrap = 'wrap';
                    eventDiv.style.justifyContent = 'center';
                    
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = 'network-node';
                    nodeDiv.textContent = event.event;
                    nodeDiv.title = `Event ${event.event}: ${event.rule} at position ${event.position}`;
                    
                    eventDiv.appendChild(nodeDiv);
                    
                    if (index < this.causalNetwork.length - 1) {
                        const edgeDiv = document.createElement('div');
                        edgeDiv.className = 'network-edge';
                        edgeDiv.textContent = '→';
                        eventDiv.appendChild(edgeDiv);
                    }
                    
                    const infoDiv = document.createElement('div');
                    infoDiv.style.fontSize = '11px';
                    infoDiv.style.color = '#aaa';
                    infoDiv.style.marginLeft = '10px';
                    infoDiv.textContent = `${event.rule} @ pos ${event.position}`;
                    eventDiv.appendChild(infoDiv);
                    
                    networkDisplay.appendChild(eventDiv);
                });
            }

            updateMultiwayDisplay() {
                // Placeholder for multiway system visualization
                this.updateCausalDisplay();
            }

            updateStats() {
                const lastEntry = this.executionHistory[this.executionHistory.length - 1];
                const activeRule = lastEntry && lastEntry.ruleApplied ? 
                    `${lastEntry.ruleApplied.pattern}→${lastEntry.ruleApplied.replacement}` : 'None';
                
                document.getElementById('currentStep').textContent = this.currentStep;
                document.getElementById('stringLength').textContent = this.currentString.length;
                document.getElementById('rulesApplied').textContent = 
                    this.executionHistory.filter(e => e.ruleApplied).length;
                document.getElementById('activeRule').textContent = activeRule;
                document.getElementById('causalEvents').textContent = this.causalNetwork.length;
            }

            start(speed = 1000) {
                if (this.isRunning) return;
                
                this.isRunning = true;
                const animate = () => {
                    if (!this.isRunning) return;
                    
                    const canContinue = this.step();
                    if (!canContinue) {
                        this.isRunning = false;
                        return;
                    }
                    
                    this.animationId = setTimeout(animate, speed);
                };
                animate();
            }

            stop() {
                this.isRunning = false;
                if (this.animationId) {
                    clearTimeout(this.animationId);
                    this.animationId = null;
                }
            }

            setViewMode(mode) {
                this.viewMode = mode;
                this.updateDisplay();
            }

            setMaxSteps(max) {
                this.maxSteps = max;
            }

            setScanMode(mode) {
                this.scanMode = mode;
            }

            setInitialString(str) {
                this.initialString = str || "AABBA";
                this.reset();
            }
        }

        // Initialize the sequential substitution system
        const sss = new SequentialSubstitutionSystem();

        // Event listeners
        document.getElementById('systemPreset').addEventListener('change', (e) => {
            const preset = e.target.value;
            const customEditor = document.getElementById('customRulesEditor');
            
            if (preset === 'custom') {
                customEditor.style.display = 'block';
            } else {
                customEditor.style.display = 'none';
                sss.setSystem(preset);
            }
        });

        document.getElementById('applyCustom').addEventListener('click', () => {
            const rulesText = document.getElementById('customRules').value;
            if (!sss.setCustomRules(rulesText)) {
                alert('Invalid rule format. Use format: AB→C (one rule per line)');
            }
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            document.getElementById('speedValue').textContent = e.target.value + 'ms';
        });

        document.getElementById('maxSteps').addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            document.getElementById('maxStepsValue').textContent = value;
            sss.setMaxSteps(value);
        });

        document.getElementById('scanMode').addEventListener('change', (e) => {
            sss.setScanMode(e.target.value);
        });

        document.getElementById('viewMode').addEventListener('change', (e) => {
            sss.setViewMode(e.target.value);
        });

        document.getElementById('initialString').addEventListener('change', (e) => {
            sss.setInitialString(e.target.value);
        });

        document.getElementById('startBtn').addEventListener('click', () => {
            const speed = parseInt(document.getElementById('speed').value);
            sss.start(speed);
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            sss.stop();
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            sss.step();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            const initialStr = document.getElementById('initialString').value;
            sss.setInitialString(initialStr);
        });
    </script>
</body>
</html>