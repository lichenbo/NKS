<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tag Systems – NKS Chapter 3</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0;
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      color: #1f1f1f;
    }
    main { max-width: 820px; margin: 0 auto; padding: 28px 20px 40px; }
    header { margin-bottom: 22px; }
    h1 { margin: 0 0 0.4rem; font-size: 1.85rem; }
    p { margin: 0; line-height: 1.55; }
    section {
      background: #fff;
      border: 1px solid #d8d8d8;
      border-radius: 10px;
      padding: 18px 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .controls { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    select, button {
      font: inherit;
      padding: 7px 9px;
      border-radius: 6px;
      border: 1px solid #b6b6b6;
      background: #fff;
      width: 100%;
    }
    button {
      background: #1f63c7;
      border-color: #1f63c7;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    button.secondary {
      background: #f1f1f1;
      border-color: #c2c2c2;
      color: #232323;
    }
    button + button { margin-top: 8px; }
    .output {
      background: #fafafa;
      border: 1px solid #d4d4d4;
      border-radius: 8px;
      padding: 16px;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.92rem;
      line-height: 1.4;
      max-height: 360px;
      overflow-y: auto;
    }
    .stats { display: flex; flex-wrap: wrap; gap: 16px; font-size: 0.95rem; margin-top: 12px; }
    .stat { min-width: 110px; }
    .deletion { color: #d62828; text-decoration: line-through; }
    .append { color: #1a7c2c; }
    ul { margin: 0; padding-left: 18px; }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>Tag Systems</h1>
      <p>
        Tag systems remove a fixed number of symbols from the front of the string and append a replacement based on the symbol
        that was just removed. The presets reproduce Wolfram’s 1-tag and 2-tag examples from chapter 3, including the famous
        system 925.
      </p>
    </header>

    <section class="controls">
      <div>
        <label for="preset">Choose system</label>
        <select id="preset">
          <option value="wolfram925">Wolfram 2-tag system #925</option>
          <option value="cyclic1">1-tag cyclic (A→B→C)</option>
          <option value="doubling">1-tag doubling (0→00, 1→11)</option>
        </select>
      </div>
      <div>
        <label>Simulation control</label>
        <button id="run-btn">Run</button>
        <button id="step-btn" class="secondary">Step once</button>
        <button id="reset-btn" class="secondary">Reset</button>
      </div>
      <div>
        <label>Rule table</label>
        <ul id="rule-list"></ul>
      </div>
    </section>

    <section>
      <div class="output" id="output"></div>
      <div class="stats">
        <div class="stat"><strong>Steps:</strong> <span id="step-count">0</span></div>
        <div class="stat"><strong>Deletion number:</strong> <span id="deletion">1</span></div>
        <div class="stat"><strong>Current length:</strong> <span id="length">0</span></div>
      </div>
    </section>
  </main>

  <script>
    const PRESETS = {
      wolfram925: {
        deletion: 2,
        initial: 'AAA',
        rules: { A: 'BC', B: 'A', C: 'AAB' }
      },
      cyclic1: {
        deletion: 1,
        initial: 'ABC',
        rules: { A: 'B', B: 'C', C: 'A' }
      },
      doubling: {
        deletion: 1,
        initial: '1',
        rules: { '0': '00', '1': '11' }
      }
    };

    class TagSystemDemo {
      constructor() {
        this.setPreset('wolfram925');
        this.running = false;
        this.timer = null;
      }

      setPreset(name) {
        const preset = PRESETS[name];
        this.deletion = preset.deletion;
        this.initial = preset.initial;
        this.rules = preset.rules;
        this.reset();
        this.renderRules();
      }

      reset() {
        this.stop();
        this.current = this.initial;
        this.history = [{ step: 0, text: this.current, deleted: '', appended: '' }];
        this.render();
      }

      step() {
        if (this.current.length < this.deletion) {
          this.stop();
          return false;
        }
        const removed = this.current.slice(0, this.deletion);
        const symbol = this.current[0];
        const append = this.rules[symbol] ?? '';
        this.current = this.current.slice(this.deletion) + append;
        const entry = {
          step: this.history.length,
          text: this.current,
          deleted: removed,
          appended: append
        };
        this.history.push(entry);
        this.render();
        return true;
      }

      run() {
        if (this.running) return;
        this.running = true;
        const loop = () => {
          if (!this.running) return;
          const progressed = this.step();
          if (progressed) {
            this.timer = setTimeout(() => requestAnimationFrame(loop), 160);
          }
        };
        loop();
      }

      stop() {
        this.running = false;
        if (this.timer) {
          clearTimeout(this.timer);
          this.timer = null;
        }
      }

      renderRules() {
        const list = document.getElementById('rule-list');
        list.innerHTML = '';
        Object.entries(this.rules).forEach(([symbol, replacement]) => {
          const li = document.createElement('li');
          li.textContent = `${symbol} → ${replacement || '∅'}`;
          list.appendChild(li);
        });
      }

      render() {
        const container = document.getElementById('output');
        container.innerHTML = '';
        this.history.forEach(entry => {
          const div = document.createElement('div');
          const deletionText = entry.deleted ? `<span class="deletion">${entry.deleted}</span>` : '';
          const appendText = entry.appended ? `<span class="append">${entry.appended}</span>` : '∅';
          div.innerHTML = `${entry.step.toString().padStart(2, '0')}: ${deletionText}${entry.deleted ? ' · ' : ''}${appendText} ⇒ ${entry.text}`;
          container.appendChild(div);
        });
        const last = this.history[this.history.length - 1];
        document.getElementById('step-count').textContent = (this.history.length - 1).toString();
        document.getElementById('deletion').textContent = this.deletion.toString();
        document.getElementById('length').textContent = last.text.length.toString();
      }
    }

    const demo = new TagSystemDemo();

    document.getElementById('preset').addEventListener('change', (event) => {
      demo.setPreset(event.target.value);
      document.getElementById('run-btn').textContent = 'Run';
    });

    document.getElementById('run-btn').addEventListener('click', () => {
      if (demo.running) {
        demo.stop();
        document.getElementById('run-btn').textContent = 'Run';
      } else {
        demo.run();
        document.getElementById('run-btn').textContent = 'Pause';
      }
    });

    document.getElementById('step-btn').addEventListener('click', () => {
      demo.stop();
      document.getElementById('run-btn').textContent = 'Run';
      demo.step();
    });

    document.getElementById('reset-btn').addEventListener('click', () => {
      demo.reset();
      document.getElementById('run-btn').textContent = 'Run';
    });
  </script>
</body>
</html>
